{% extends "RigauxtForumBundle::layout.html.twig" %}

{% block title %}{{ parent() }} - {% if titre == null %}Index{% else %}{{ titre }}{% endif %}{% endblock %}

{% block rigauxtforum_body %}
	<div class="row">
		<div class="col-md-12">
			<div class="well" style="padding: 10px">
				<span class="glyphicon glyphicon-tower"></span>
				{% for nom, lien in ariane %}
					 {% if loop.first == false %}/{% endif %} {% if loop.last == false %}<a href="{{ lien }}">{% endif %}{{ nom }}{% if loop.last == false %}</a>{% endif %}
				{% endfor %}
			</div>
			
			<h2>Forum</h2>
			
			<hr>
			
			<table class="table table-striped table-hover">
				{% for theme, categories in themes %}
					<thead>
						<tr>
							<th style="width: 14px">
							</th>
							<th>
								<span class="glyphicon glyphicon-bookmark"></span> {{ theme }}
							</th>
							<th style="width: 200px">
							</th>
						</tr>
					</thead>
					<tbody>
						{% for id, categorie in categories %}
							<tr>
								<td>
									{% if random(1) %}
										<span style="margin-top: 24px" class="glyphicon glyphicon-unchecked"></span>
									{% endif %}
								</td>
								<td>
									<a class="removeLink" href="{{ path('rigauxt_forum_index', {'slugPere': categorie.slug}) }}">
										<h4>{{ categorie.nom }}</h4>
										<h6>{{ categorie.description }}</h6>
									</a>
								</td>
								<td>
									{% if themesPost[theme][id] != null %}
										<a class="removeLink" href="#">
											Il y a {{ themesPost[theme][id].timeSince }}
										</a>
										par
										<a class="removeLink" href="#">
											{{ themesPost[theme][id].author.username }}
										</a>
										dans
										<a class="removeLink" href="#">
											{{ themesPost[theme][id].topic.title }}
										</a>
									{% endif %}
								</td>
							</tr>
						{% endfor %}
					</tbody>
				{% endfor%}
			</table>
			
			{% if titre != null %}
				<div class="jumbotron">
					<h2 style="color: #FFF; margin: 0; margin-top: -10px; text-align: center">Discussions</h2>
			
					{% if slug != null and app.user != null %}
						<a class="btn btn-primary" href="{{ path('rigauxt_forum_topic_add', {'slug': slug}) }}">
							<span class="glyphicon glyphicon-plus-sign"></span>
							Nouveau Topic
						</a>
					{% endif %}
					{% if (topics != null and topics|length > 0) or (postIts != null and postIts|length > 0) %}
						<table class="table table-striped table-hover">
							<thead>
								<tr>
									<th style="width: 14px">
									</th>
									<th style="width: 150px">
										Auteur
									</th>
									<th>
										Titre
									</th>
								</tr>
							</thead>
							<tbody>
								{% for id, postIt in postIts %}
									<tr>
										<td>
											<span style="color: #{% if random(2) %}3A3{% else %}A33{% endif %}; margin-top: 9px" class="glyphicon glyphicon-paperclip"></span>
										</td>
										<td>
											<a class="removeLink" href="{{ path('rigauxt_user_profile', {'username': postIt.author.username}) }}">
												<img
													style="width: 32px; height: auto"
													src="{{ asset_if(postIt.author.webPath) }}" alt="{{ postIt.author.avatarAlt }}"
												/>
												{% if postIt.author.nom != null or postIt.author.prenom != null %}
													{{ postIt.author.prenom }}
													{% if postIt.author.prenom != null %}
													{% endif %}
													{{ postIt.author.nom }}
												{% else %}
													{{ postIt.author.username }}
												{% endif %}
											</a>
										</td>
										<td>
											<a class="removeLink" href="{{ path('rigauxt_forum_topic_view', {'slug': postIt.slug}) }}">
												<h4>{{ postIt.title }}</h4>
											</a>
										</td>
									</tr>
								{% endfor %}
							</tbody>
							<thead>
								<tr>
									<th>
									</th>
									<th>
									</th>
									<th>
									</th>
								</tr>
							</thead>
							<tbody>
								{% for id, topic in topics %}
									<tr>
										<td>
											<span style="color: #{% if random(1) %}3A3{% else %}A33{% endif %}; margin-top: 9px" class="glyphicon glyphicon-file"></span>
										</td>
										<td>
											<a class="removeLink" href="{{ path('rigauxt_user_profile', {'username': topic.author.username}) }}">
												<img
													style="width: 32px; height: auto"
													src="{{ asset_if(topic.author.webPath) }}" alt="{{ topic.author.avatarAlt }}"
												/>
												{% if topic.author.nom != null or topic.author.prenom != null %}
													{{ topic.author.prenom }}
													{% if topic.author.prenom != null %}
													{% endif %}
													{{ topic.author.nom }}
												{% else %}
													{{ topic.author.username }}
												{% endif %}
											</a>
										</td>
										<td>
											<a class="removeLink" href="{{ path('rigauxt_forum_topic_view', {'slug': topic.slug}) }}">
												<h4>{{ topic.title }}</h4>
											</a>
										</td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
					{% else %}
						<div>
							Aucune Discussion.
						</div>
					{% endif %}
				</div>
			{% endif %}
		</div>
	</div>
	<div class="alert alert-success">
		// Deja fait : Forum avec : catégories, (arbre) sous-forums, posts (avec possibilité de mettre en post-it, ...), messages dans posts, tri et affichage des topics en fonction du type, ...
	</div>
	<div class="alert alert-warning">
		// Todo : Gestion des catégories, gestion poussée des topics (modif, suppression, déplacement, ...), ajout d'info complémentaires (nb posts, date dernier post, date premier post, ...), ajout d'info sur les auteurs(nb posts, info comme job, ...)
	</div>
{% endblock %}
